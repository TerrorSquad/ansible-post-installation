---
- name: Download and install RescueTime
  block:
    - name: Download RescueTime
      get_url:
        url: https://www.rescuetime.com/installers/rescuetime_current_amd64.deb
        dest: "{{ download_dir }}/rescuetime.deb"
    - name: Install RescueTime
      apt:
        deb: "{{ download_dir }}/rescuetime.deb"

- name: Download and install Google Chrome
  block:
    - name: Download Google Chrome
      get_url:
        url: https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        dest: "{{ download_dir }}/google-chrome-stable_current_amd64.deb"
    - name: Install Google Chrome
      apt:
        deb: "{{ download_dir }}/google-chrome-stable_current_amd64.deb"

- name: Download and install Zoom
  block:
    - name: Download Zoom
      get_url:
        url: https://zoom.us/client/latest/zoom_amd64.deb
        dest: "{{ download_dir }}/zoom_amd64.deb"
    - name: Install Zoom
      apt:
        deb: "{{ download_dir }}/zoom_amd64.deb"

- name: Download and install Viber
  block:
    - name: Download Viber
      get_url:
        url: https://download.cdn.viber.com/cdn/desktop/Linux/viber.deb
        dest: "{{ download_dir }}/viber.deb"
    - name: Install Viber
      apt:
        deb: "{{ download_dir }}/viber.deb"

- name: Download and install Tixati
  block:
    - name: Download Tixati page
      get_url:
        url: https://www.tixati.com/download/linux.html
        dest: "{{ download_dir }}/tixati.html"
    - name: Find out latest Tixati URL
      shell: |
        grep  -oP "<a href=(.+amd64.deb)\">" "{{ download_dir }}/tixati.html" | grep -oP  "http.+amd64.deb"  | xargs wget -O "{{ download_dir }}/tixati.deb"
    - name: Install Tixati
      apt:
        deb: "{{ download_dir }}/tixati.deb"

- name: Set Tixati as default torrent client
  shell: |
    gio mime x-scheme-handler/magnet tixati.desktop
  when: ansible_distribution == 'Linux Mint'

- name: Download and install UnifiedRemote
  block:
    - name: Download UnifiedRemote
      get_url:
        url: https://www.unifiedremote.com/download/linux-x64-deb
        dest: "{{ download_dir }}/uremote.deb"
    - name: Install UnifiedRemote
      apt:
        deb: "{{ download_dir }}/uremote.deb"

- name: Add Folder color nemo repo
  shell: |
    add-apt-repository ppa:costales/folder-color -y

- name: Update apt cache
  apt:
    update_cache: true

- name: Install apt apps - Variety, Flameshot, Bleachbit
  apt:
    name:
      - bleachbit
      - fd-find
      - flameshot
      - folder-color-nemo
      - fzf
      - httpie
      - ncdu
      - papirus-icon-theme
      - peco
      - silversearcher-ag
      - skypeforlinux
      - thefuck
      - tlp
      - unzip
      - variety
      - vlc

- name: Install snap apps (classic) - Skype, alacritty
  snap:
    name:
      - alacritty
    classic: true

- name: Download and install Mailspring
  block:
    - name: Download Mailspring page
      get_url:
        url: https://github.com/Foundry376/Mailspring/releases/
        dest: "{{ download_dir }}/delta.html"
    - name: Download Mailspring package
      shell: |
        URL=https://github.com/;
        FILE_NAME=$(grep -oP "/.+_amd64\.deb" "{{ download_dir }}/Mailspring.html" | grep -v musl | head -n 1);
        echo $URL$FILE_NAME | xargs wget -O "{{ download_dir }}/mailspring.deb"
    - name: Install Mailspring
      apt:
        deb: "{{ download_dir }}/mailspring.deb"
        force: true

# TODO: Move to apt - https://helpcenter.onlyoffice.com/installation/desktop-install-ubuntu.aspx
- name: Install snap apps - OnlyOffice Editors
  snap:
    name:
      - onlyoffice-desktopeditors

- name: "Create {{ local_bin }} directory"
  file:
    path: "{{ local_bin }}"
    state: directory
  become_user: "{{ username }}"

- name: Copy theme_changer.sh script
  copy:
    src: "./defaults/scripts/theme_changer.sh"
    dest: "{{ local_bin }}"
    mode: u+x
  become_user: "{{ username }}"
