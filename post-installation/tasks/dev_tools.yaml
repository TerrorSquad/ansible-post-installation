---
- name: Install apt apps - curl, VIm, Terminator, RedShift, htop
  apt:
    name:
      - bat
      - curl
      - zip
      - unzip
      - guake
      - htop
      - libutempter0
      - make
      - redshift
      - redshift-gtk
      - shellcheck
      - terminator
      - vim
      - kcachegrind
      - graphviz
      - jq

- name: Install SDKMan
  shell: |
    curl -s "https://get.sdkman.io" | zsh

- name: Download and install GitKraken
  block:
    - name: Download GitKraken
      get_url:
        url: https://release.axocdn.com/linux/gitkraken-amd64.deb
        dest: "{{ download_dir }}/gitkraken.deb"
    - name: Install GitKraken
      apt:
        deb: "{{ download_dir }}/gitkraken.deb"
        force: true

- name: Download and install DBeaver
  block:
    - name: Download DBeaver
      get_url:
        url: https://dbeaver.io/files/dbeaver-ce_latest_amd64.deb
        dest: "{{ download_dir }}/dbeaver.deb"
    - name: Install DBeaver
      apt:
        deb: "{{ download_dir }}/dbeaver.deb"
        force: true

- name: Download and install Hyperfine
  block:
    - name: Download Hyperfine page
      get_url:
        url: https://github.com/sharkdp/hyperfine/releases/
        dest: "{{ download_dir }}/hyperfine.html"

    - name: Download latest hyperfine package
      shell: |
        URL=https://github.com/;
        FILE_NAME=$(grep -oP "/.+_amd64\.deb" "{{ download_dir }}/hyperfine.html" | grep -v musl | head -n 1);
        echo $URL$FILE_NAME | xargs wget -O "{{ download_dir }}/hyperfine.deb"
    - name: Install Hyperfine
      apt:
        deb: "{{ download_dir }}/hyperfine.deb"
        force: true

# TODO: Make this a task and pass it the URL
- name: Download and install Slack
  block:
    - name: Download Slack page
      get_url:
        url: https://slack.com/intl/en-rs/downloads/instructions/ubuntu
        dest: "{{ download_dir }}/slack.html"

    - name: Download latest slack package
      shell: |
        URL=https://downloads.slack-edge.com/releases/linux/;
        FILE_NAME=$(grep -oP  "(slack-desktop)-([0-9]+\.[0-9]+\.[0-9]+)-(amd64.deb)" "{{ download_dir }}/slack.html" | head -n 1 );
        VERSION=$(echo $FILE_NAME | egrep -o "[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}");
        echo $URL$VERSION/prod/x64/$FILE_NAME | xargs wget -O "{{ download_dir }}/slack.deb"
    - name: Install Slack
      apt:
        deb: "{{ download_dir }}/slack.deb"
        force: true

- name: Download and install ripgrep
  block:
    - name: Download ripgrep page
      get_url:
        url: https://github.com/BurntSushi/ripgrep/releases/
        dest: "{{ download_dir }}/ripgrep.html"
    - name: Download latest ripgrep package
      shell: |
        URL=https://github.com/;
        FILE_NAME=$(grep -oP "/.+_amd64\.deb" "{{ download_dir }}/ripgrep.html" | grep -v musl | head -n 1);
        echo $URL$FILE_NAME | xargs wget -O "{{ download_dir }}/ripgrep.deb"
    - name: Install ripgrep
      apt:
        deb: "{{ download_dir }}/ripgrep.deb"
        force: true

- name: Install exa
  copy:
    src: ./defaults/executables/exa-linux-x86_64
    dest: /usr/local/bin/exa
    mode: 0755
    owner: "{{ username }}"

- name: Copy RedShift configuration file
  copy:
    src: ./defaults/.config/redshift.conf
    dest: "{{ config_home }}"
  become_user: "{{ username }}"

- name: Create Terminator config directory path
  file:
    dest: "{{ terminator_config_dir }}"
    state: directory
  become_user: "{{ username }}"

- name: Configure Terminator
  copy:
    src: ./defaults/.config/terminator/config
    dest: "{{ terminator_config_file }}"
  become_user: "{{ username }}"

- name: Download and install JetBrains ToolBox
  shell: |
    curl -fsSL https://raw.githubusercontent.com/nagygergo/jetbrains-toolbox-install/master/jetbrains-toolbox.sh | bash

- name: Download and install Visual Studio Code
  block:
    - name: Download Visual Studio Code
      get_url:
        url: https://code.visualstudio.com/sha/download?build=stable&os=linux-deb-x64
        dest: "{{ download_dir }}/vscode.deb"
    - name: Install Visual Studio Code
      apt:
        deb: "{{ download_dir }}/vscode.deb"
        force: true

- name: Install snap apps - Postman, httpstat
  snap:
    name:
      - httpstat
      - postman
      - procs
    classic: false

- name: Sublime text
  block:
    - name: Install the GPG key
      apt_key:
        url: https://download.sublimetext.com/sublimehq-pub.gpg

    - name: Install dependencies
      apt:
        name:
          - apt-transport-https
          - ca-certificates
        force: true
        state: latest

    - name: Add apt repository
      shell: |
        echo "deb https://download.sublimetext.com/ apt/stable/" | sudo tee /etc/apt/sources.list.d/sublime-text.list

    - name:
      apt:
        update_cache: true

    - name: Add sublime text
      apt:
        name:
          - sublime-text

- name: Download and install Dust
  block:
    - name: "Create Dust directory"
      file:
        path: "{{ download_dir }}/dust"
        state: directory

    - name: Download Dust page
      get_url:
        url: https://github.com/bootandy/dust/releases/
        dest: "{{ download_dir }}/dust/dust.html"

    - name: Download latest Dust package
      shell: |
        URL=https://github.com/;
        FILE_NAME=$(grep -oP "/.+x86_64.*?linux.*?\.tar.gz" "{{ download_dir }}/dust/dust.html" | grep -v musl | head -n 1);
        echo $URL$FILE_NAME | xargs wget -O "{{ download_dir }}/dust/dust.tar.gz"

    - name: Extract Dust
      shell: |
        cd "{{ download_dir }}/dust" && tar -xvf dust.tar.gz -C . && mv dust-*/* .

    - name: Install dust
      shell: |
        cp "{{ download_dir }}/dust/dust" /usr/local/bin && chmod +x /usr/local/bin/dust

- name: Download and install duf
  block:
    - name: Download duf page
      get_url:
        url: https://github.com/muesli/duf/releases/
        dest: "{{ download_dir }}/duf.html"

    - name: Download latest duf package
      shell: |
        URL=https://github.com/;
        FILE_NAME=$(grep -oP "/.+_amd64\.deb" "{{ download_dir }}/duf.html" | grep -v musl | head -n 1);
        echo $URL$FILE_NAME | xargs wget -O "{{ download_dir }}/duf.deb"
    - name: Install duf
      apt:
        deb: "{{ download_dir }}/duf.deb"
        force: true

- name: Download and install bottom
  block:
    - name: Download bottom page
      get_url:
        url: https://github.com/ClementTsang/bottom/releases/
        dest: "{{ download_dir }}/bottom.html"

    - name: Download latest bottom package
      shell: |
        URL=https://github.com/;
        FILE_NAME=$(grep -oP "/.+_amd64\.deb" "{{ download_dir }}/bottom.html" | grep -v musl | head -n 1);
        echo $URL$FILE_NAME | xargs wget -O "{{ download_dir }}/bottom.deb"
    - name: Install bottom
      apt:
        deb: "{{ download_dir }}/bottom.deb"
        force: true

- name: Download and install curlie
  block:
    - name: Download curlie page
      get_url:
        url: https://github.com/rs/curlie/releases/
        dest: "{{ download_dir }}/curlie.html"

    - name: Download latest curlie package
      shell: |
        URL=https://github.com/;
        FILE_NAME=$(grep -oP "/.+_amd64\.deb" "{{ download_dir }}/curlie.html" | grep -v musl | head -n 1);
        echo $URL$FILE_NAME | xargs wget -O "{{ download_dir }}/curlie.deb"
    - name: Install curlie
      apt:
        deb: "{{ download_dir }}/curlie.deb"
        force: true


- name: Install albert
  block:
    - name: Add sources repo
      shell: |
        echo 'deb http://download.opensuse.org/repositories/home:/manuelschneid3r/xUbuntu_20.04/ /' | sudo tee /etc/apt/sources.list.d/home:manuelschneid3r.list
      become_user: "{{ username }}"
    - name: Add gpg key
      shell: |
        curl -fsSL https://download.opensuse.org/repositories/home:manuelschneid3r/xUbuntu_20.04/Release.key | gpg --dearmor | sudo tee /etc/apt/trusted.gpg.d/home_manuelschneid3r.gpg > /dev/null
      become_user: "{{ username }}"
    - name: Update apt cache
      apt:
        update_cache: true
    - name: Install Albert
      apt:
        name:
          albert
