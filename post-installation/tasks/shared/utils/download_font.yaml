---
- name: Check if font {{ item.name }} is already installed
  ansible.builtin.shell: "fc-list : family | grep -i '{{ item.name }}'"
  register: font_check
  failed_when: false
  changed_when: false
  ignore_errors: true

- name: "Download Nerd Font {{ item.filename }}"
  ansible.builtin.get_url:
    url: "https://github.com/ryanoasis/nerd-fonts/releases/latest/download/{{ item.filename }}"
    dest: "{{ download_dir }}/{{ item.filename }}"
    mode: "0644"
    timeout: 60
  register: download_font_result
  until: download_font_result is success
  retries: 3
  delay: 2
  ignore_errors: true
  when: font_check.rc != 0

- name: "Warn if font download failed"
  ansible.builtin.debug:
    msg:
      - "⚠️  Failed to download {{ item.name }} font."
      - "Please install it manually from: https://github.com/ryanoasis/nerd-fonts/releases/latest/download/{{ item.filename }}"
  when: download_font_result is failed
