---
- name: Install VPN clients via Homebrew
  community.general.homebrew:
    name:
      - openconnect
    state: present
    path: "{{ homebrew_path }}"
  register: brew_vpn_result
  until: brew_vpn_result is success
  retries: 3
  delay: 2
  become: false

- name: Install VPN GUI clients via Homebrew Cask
  community.general.homebrew_cask:
    name:
      - tunnelblick
    state: present
  become_user: "{{ username }}"
  become: true
  register: vpn_cask_result
  until: vpn_cask_result is success
  retries: 3
  delay: 2
  failed_when: false

- name: Log VPN cask installation status
  ansible.builtin.debug:
    msg: "VPN GUI installation {{ 'succeeded' if not vpn_cask_result.failed else 'had issues - this is non-critical' }}"
