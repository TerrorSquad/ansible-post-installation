---
- name: Check if Homebrew is already installed
  ansible.builtin.stat:
    path: "{{ homebrew_path }}/brew"
  register: homebrew_exists

- name: Install Homebrew on macOS
  ansible.builtin.shell:
    cmd: NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    executable: /bin/bash
  become_user: "{{ username }}"
  become: true
  register: homebrew_install
  changed_when: homebrew_install.rc == 0
  when: not homebrew_exists.stat.exists
