---
# System preparation for Debian-based systems
- name: Remove snap if configured
  ansible.builtin.include_tasks: remove_snap.yaml

- name: Update APT cache
  ansible.builtin.apt:
    update_cache: true

- name: Upgrade APT applications
  ansible.builtin.apt:
    upgrade: dist
    update_cache: true

- name: Create download directory
  ansible.builtin.file:
    dest: "{{ download_dir }}"
    state: directory
    mode: "0777"

- name: Install system prerequisites (required for Homebrew)
  ansible.builtin.apt:
    name: "{{ tool_sets.system_prerequisites }}"
    state: present
  register: apt_prereq_result
  until: apt_prereq_result is success
  retries: 3
  delay: 2
