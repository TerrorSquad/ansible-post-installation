---
- name: Install apt apps - curl, VIm, Terminator, RedShift, htop
  ansible.builtin.apt:
    name:
      - bat
      - curl
      - zip
      - unzip
      - htop
      - libutempter0
      - make
      - shellcheck
      - vim
      - python3-pip
      - jq

# - name: Install SDKMan
#   ansible.builtin.shell: |
#     curl -s "https://get.sdkman.io" | bash
#   become_user: "{{ username }}"
#   become: true

- name: Copy Zscaler root cert to $HOME
  ansible.builtin.copy:
    src: ./defaults/.ZscalerRootCA.crt
    dest: "{{ user_home }}"
    mode: "0644"
  become_user: "{{ username }}"
  become: true

- name: Install Volta
  ansible.builtin.get_url:
    url: "https://get.volta.sh"
    dest: "/tmp/volta.sh"
    mode: "0755"
  become_user: "{{ username }}"
  become: true

- name: Execute Volta installation script
  ansible.builtin.shell: |
    set -o pipefail
    "/tmp/volta.sh | bash"
  become_user: "{{ username }}"
  become: true
  args:
    creates: "/home/{{ username }}/.volta"

- name: Install latest NodeJS using Volta
  ansible.builtin.shell: >
    zsh -i -c "volta install node"
  become_user: "{{ username }}"
  become: true
  args:
    creates: "/home/{{ username }}/.volta/tools/node"

- name: Install latest PNPM using Volta
  ansible.builtin.shell: >
    zsh -i -c "volta install pnpm"
  become_user: "{{ username }}"
  become: true
  args:
    creates: "/home/{{ username }}/.volta/tools/pnpm"

- name: Install homebrew packages
  ansible.builtin.shell: |
    HOMEBREW_NO_AUTO_UPDATE=1 HOMEBREW_NO_ENV_HINTS=1 /home/linuxbrew/.linuxbrew/bin/brew install \
      bottom \
      broot \
      btop \
      curlie \
      duf \
      dust \
      lazydocker \
      eza \
      fd \
      gh \
      git-quick-stats \
      gping \
      gping \
      httpstat \
      hyperfine \
      lnav \
      oha \
      procs \
      ripgrep \
      sd \
      tealdeer \
      tokei \
      xh \
      yazi

  become_user: "{{ username }}"
  become: true
  args:
    creates: "/home/{{ username }}/.linuxbrew/bin/bottom"

- name: Install Rust tools
  ansible.builtin.shell: |
    set -o pipefail
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
  become_user: "{{ username }}"
  become: true
  args:
    creates: "/home/{{ username }}/.cargo/bin/rustc"
